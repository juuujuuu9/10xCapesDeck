---
import { LazyVideo } from '../../LazyVideo.tsx';
import { bunnyImage, bunnyVideoFile } from '../../../lib/bunny-cdn';

export interface Props {
	video: {
		src: string;
		poster?: string;
		pullZone?: string;
		priority?: boolean;
	};
	className?: string;
}

const { video, className = '' } = Astro.props;

// Generate poster URL if provided
const posterUrl = video.poster 
	? (video.poster.startsWith('http') 
		? video.poster 
		: bunnyImage(video.poster, {
			pullZone: video.pullZone || 'storage',
			width: 1920,
			quality: 85
		}))
	: undefined;

// Generate video URL
const videoSrc = video.src.startsWith('http') 
	? video.src 
	: bunnyVideoFile(video.src, video.pullZone || 'storage');
---

<section class={`bg-black w-full max-w-screen mx-auto h-dvh flex flex-col items-center justify-center snap-start snap-always px-0 ${className}`}>
	<LazyVideo
		client:load
		src={videoSrc}
		poster={posterUrl}
		autoPlay
		muted={true}
		loop
		playsInline
		showUnmuteButton={true}
		priority={video.priority !== undefined ? video.priority : true}
		className="w-full h-full object-cover"
	/>
</section>
