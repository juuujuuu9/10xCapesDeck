---
import { LazyImage } from '../../LazyImage.tsx';
import { LazyVideo } from '../../LazyVideo.tsx';
import { bunnyImage } from '../../../lib/bunny-cdn';

export interface Props {
	images: Array<{
		src: string;
		alt: string;
		label: string;
		pullZone?: string;
		priority?: boolean;
		width?: number;
		quality?: number;
		type?: 'image' | 'video'; // Defaults to 'image'
	}>;
}

const { images } = Astro.props;

// Ensure we have exactly 3 images
if (images.length !== 3) {
	throw new Error('ThreeImageGridFlipped requires exactly 3 images');
}

const [topLeftImage, bottomLeftImage, rightImage] = images;
---

<section class="w-full h-dvh max-h-dvh p-2 md:p-4 lg:p-8 snap-start snap-always flex flex-col overflow-hidden box-border">
	<div class="w-full flex-1 min-h-0 grid grid-cols-1 md:grid-cols-2 grid-rows-[2fr_1fr] md:grid-rows-1 gap-2 md:gap-4 lg:gap-8">
		{/* Left Side - Two stacked panels */}
		<div class="flex flex-col gap-2 md:gap-4 lg:gap-8 min-h-0">
			{/* Top Left Panel */}
			<div class="relative flex-1 min-h-0 overflow-hidden">
				{topLeftImage.type === 'video' ? (
					<LazyVideo
						client:load
						src={topLeftImage.src}
						pullZone={topLeftImage.pullZone}
						priority={topLeftImage.priority || false}
						autoPlay
						muted
						loop
						playsInline
						className="w-full h-full object-cover"
					/>
				) : (
					<LazyImage
						client:visible
						src={topLeftImage.src}
						alt={topLeftImage.alt}
						pullZone={topLeftImage.pullZone}
						priority={topLeftImage.priority || false}
						width={topLeftImage.width || 1200}
						quality={topLeftImage.quality || 85}
						className="w-full h-full object-cover"
					/>
				)}
				<div class="absolute bottom-0 left-0 px-3 md:px-4 lg:px-6 py-1.5 md:py-2 lg:py-3">
					<span class="text-white text-lg md:text-xl lg:text-2xl font-light lowercase tracking-wide">
						{topLeftImage.label}
					</span>
				</div>
			</div>

			{/* Bottom Left Panel */}
			<div class="relative flex-1 min-h-0 overflow-hidden">
				{bottomLeftImage.type === 'video' ? (
					<LazyVideo
						client:load
						src={bottomLeftImage.src}
						pullZone={bottomLeftImage.pullZone}
						priority={bottomLeftImage.priority || false}
						autoPlay
						muted
						loop
						playsInline
						className="w-full h-full object-cover"
					/>
				) : (
					<LazyImage
						client:visible
						src={bottomLeftImage.src}
						alt={bottomLeftImage.alt}
						pullZone={bottomLeftImage.pullZone}
						priority={bottomLeftImage.priority || false}
						width={bottomLeftImage.width || 1200}
						quality={bottomLeftImage.quality || 85}
						className="w-full h-full object-cover"
					/>
				)}
				<div class="absolute bottom-0 left-0 px-3 md:px-4 lg:px-6 py-1.5 md:py-2 lg:py-3">
					<span class="text-white text-lg md:text-xl lg:text-2xl font-light lowercase tracking-wide">
						{bottomLeftImage.label}
					</span>
				</div>
			</div>
		</div>

		{/* Right Panel - Full height on desktop, 1/3 height on mobile */}
		<div class="relative w-full min-h-0 overflow-hidden justify-self-start xl:justify-self-end">
			{rightImage.type === 'video' ? (
				<LazyVideo
					client:load
					src={rightImage.src}
					pullZone={rightImage.pullZone}
					priority={rightImage.priority || false}
					autoPlay
					muted
					loop
					playsInline
					className="w-full h-full object-cover"
				/>
			) : (
				<LazyImage
					client:visible
					src={rightImage.src}
					alt={rightImage.alt}
					pullZone={rightImage.pullZone}
					priority={rightImage.priority || false}
					width={rightImage.width || 1200}
					quality={rightImage.quality || 85}
					className="w-full h-full object-cover"
				/>
			)}
			<div class="absolute bottom-0 left-0 px-3 md:px-4 lg:px-4 py-1.5 md:py-2 lg:py-3">
				<span class="text-white text-lg md:text-xl lg:text-2xl font-light lowercase tracking-wide">
					{rightImage.label}
				</span>
			</div>
		</div>
	</div>
</section>
