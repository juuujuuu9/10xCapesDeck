---
import '../../styles/global.css';
import { bunnyImage } from '../../lib/bunny-cdn';
import C4CaseStudy from '../../components/sections/C4CaseStudy/C4CaseStudy.astro';
import ReelSection from '../../components/sections/ReelSection/ReelSection.astro';
import TalentBrandPartnership from '../../components/sections/TwoBlockGrid/TalentBrandPartnership.astro';
import IgniteYourFireResults from '../../components/sections/C4CaseStudy/IgniteYourFireResults.astro';
import C4OOHActivation from '../../components/sections/C4CaseStudy/C4OOHActivation.astro';
import NavigationLinks from '../../components/sections/NavigationLinks/NavigationLinks.astro';
import HashScrollInit from '../../components/HashScrollInit.astro';
import Navigation from '../../components/Navigation.astro';

// RULE-021: WordPress URL auto-conversion to Bunny CDN
const c4FrozenBombsicleBg = bunnyImage('/wp-content/uploads/2025/02/C4-Frozen-Bombsicle-scaled.jpg', {
	pullZone: 'wordpress',
	width: 1920,
	quality: 85
});
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>C4 Energy - Case Study | times10</title>
	</head>
	<body class="font-sans overflow-x-hidden bg-[#fdfffd]">
		<script>
			// Global error handler to prevent jQuery errors from breaking the page
			// jQuery may be injected by browser extensions or dev tools
			(function() {
				// Catch unhandled errors (including jQuery selector errors)
				window.addEventListener('error', function(event) {
					// Check if it's the jQuery selector error
					if (event.message && (
						event.message.includes("is not a valid selector") ||
						event.message.includes("*,:x") ||
						event.filename && event.filename.includes('jquery')
					)) {
						// Prevent the error from breaking the page
						event.preventDefault();
						console.warn('[Error Handler] Caught jQuery selector error (likely from browser extension):', event.message);
						return false;
					}
				}, true); // Use capture phase to catch errors early

				// Also catch unhandled promise rejections
				window.addEventListener('unhandledrejection', function(event) {
					if (event.reason && (
						event.reason.message && event.reason.message.includes("is not a valid selector") ||
						event.reason.message && event.reason.message.includes("*,:x")
					)) {
						event.preventDefault();
						console.warn('[Error Handler] Caught jQuery promise rejection:', event.reason);
					}
				});
			})();
		</script>
	<Navigation />
		<script>
			// Development: Save and restore scroll position
			// Remove this in production by deleting the script or setting ENABLE_SCROLL_RESTORE=false
			(function() {
				const STORAGE_KEY = 'dev-scroll-section';
				
				function initScrollRestore() {
					// Skip scroll restore if there's a hash in the URL (hash-scroll handles it)
					if (window.location.hash) {
						return;
					}
					
					const sections = document.querySelectorAll('section[class*="snap-start"]');
					if (sections.length === 0) return;
					
					// Restore scroll position on load
					const savedIndex = sessionStorage.getItem(STORAGE_KEY);
					if (savedIndex !== null) {
						const index = parseInt(savedIndex, 10);
						if (index >= 0 && index < sections.length) {
							// Small delay to ensure layout is complete
							setTimeout(() => {
								sections[index].scrollIntoView({ behavior: 'instant' });
							}, 100);
						}
					}
					
					// Track current section using IntersectionObserver
					const observer = new IntersectionObserver((entries) => {
						entries.forEach((entry) => {
							if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
								const index = Array.from(sections).indexOf(entry.target);
								if (index !== -1) {
									sessionStorage.setItem(STORAGE_KEY, index.toString());
								}
							}
						});
					}, {
						threshold: 0.5,
						rootMargin: '-20% 0px -20% 0px'
					});
					
					// Observe all sections
					sections.forEach((section) => observer.observe(section));
				}
				
				// Wait for DOM to be ready
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initScrollRestore);
				} else {
					initScrollRestore();
				}
			})();
		</script>
		<section 
			id="c4-frozen"
			class="w-full h-dvh snap-start snap-always bg-no-repeat flex items-center justify-center relative bg-black"
			style={`background-image: url('${c4FrozenBombsicleBg}'); background-position: 40% 50%; background-size: cover;`}
		>
			<div 
				id="c4-frozen-overlay"
				class="absolute inset-0 bg-black transition-opacity duration-1000 ease-in-out"
			></div>
		</section>
		<script>
			// Fade in/out black overlay when section enters/exits viewport
			(function() {
				const overlay = document.getElementById('c4-frozen-overlay');
				if (!overlay) return;

				// Check for reduced motion preference
				const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
				
				// If reduced motion, hide overlay immediately
				if (prefersReducedMotion) {
					overlay.style.opacity = '0';
					return;
				}

				// Use Intersection Observer to trigger fade in/out
				const section = document.getElementById('c4-frozen');
				if (!section) return;

				const observer = new IntersectionObserver((entries) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting) {
							// Fade out the black overlay to reveal background image
							overlay.style.opacity = '0';
						} else {
							// Fade in the black overlay when section exits viewport
							overlay.style.opacity = '1';
						}
					});
				}, {
					threshold: 0.1,
					rootMargin: '0px'
				});

				observer.observe(section);
			})();
		</script>
		<C4CaseStudy
			id="c4-case-study"
			image={{
				src: '/wp-content/uploads/2025/09/10.16.21-C4-KEVIN-HART-IYF-NEW-25_EDIT-2.jpg',
				alt: 'Kevin Hart with C4 Energy drink',
				pullZone: 'wordpress',
				width: 1200,
				quality: 85
			}}
			challenge="Develop a breakthrough brand campaign to launch C4 Energy into the ready-to-drink space, transitioning from a pre-workout supplement brand to a major player in the energy drink category."
			whatWeDid="Times10 launched a full-funnel brand campaign to introduce Ignite Your Fire (IYF) and establish C4 as a cultural force in the energy drink space. We developed a bold creative platform that merged fitness, music, fashion, and lifestyle, designed to connect with the next generation of energy drinkers across every touchpoint."
			keyInitiatives={[
				'Integrated Brand Platform: Built "Ignite Your Fire" as a unifying creative idea across all channels and assets.',
				'Talent Partnerships: Cast a diverse group of athletes, musicians, and creators to represent the campaign authentically.',
				'Content Creation: Produced high-energy hero films, social-first cuts, disruptive digital assets, and on-the-ground activation content.',
				'Social & Digital Strategy: Deployed content across Meta, YouTube, TikTok, and influencer channels to build awareness and drive trial.',
				'Retail Integration: Extended the campaign to in-store environments with bold visuals and QR-to-content engagement.',
				'Earned & Owned Media Push: Delivered a cohesive story through organic and paid content to amplify reach and conversions.'
			]}
		/>
		<ReelSection
			id="c4-reel"
			video={{
				src: 'https://times-10-video-offload.b-cdn.net/1%20Min%20Collab%20IYF.mp4',
				pullZone: 'storage',
				priority: true
			}}
		/>
		<TalentBrandPartnership
			id="talent-brand-partnership"
			block1={{
				title: 'talent + brand partnerships',
				twoImages: {
					image1: {
						src: '/wp-content/uploads/2025/02/Site-Banner-390x390-1.jpg',
						alt: 'C4 Ignite Your Fire Campaign',
						pullZone: 'wordpress',
						width: 1200,
						quality: 85
					},
					image2: {
						src: '/wp-content/uploads/2025/02/C4-WWE-Bianca-Roman-960x960-1.jpeg',
						alt: 'C4 WWE Bianca Belair and Roman Reigns',
						pullZone: 'wordpress',
						width: 1200,
						quality: 85
					}
				},
				fullWidthImage: {
					src: '/wp-content/uploads/2025/02/C4-Smart-Energy-Lindsay-Brewer-1920x1080-1.jpg',
					alt: 'Lindsay Brewer C4 Smart Energy Partnership',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			}}
			block2={{
				title: 'digital execution',
				image: {
					src: '/wp-content/uploads/2025/02/jf-espn-takeover-yellow-drinking.jpeg',
					alt: 'ESPN Digital Takeover C4 Energy',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			}}
		/>
		<IgniteYourFireResults
			id="ignite-your-fire-results"
			phoneImage={{
				src: '/wp-content/uploads/2025/09/C4-IG-Grid-IYF-copy.png',
				alt: 'C4 Energy Instagram Profile showing Ignite Your Fire campaign',
				pullZone: 'wordpress',
				width: 800,
				quality: 85
			}}
		/>
		<C4OOHActivation
			id="c4-ooh-activation"
			stats={[
				{ label: 'cans passed out', value: '500k+' },
				{ label: 'social impressions', value: '100m+' },
				{ label: 'billboards', value: '45' },
				{ label: 'events', value: '50+' },
				{ label: 'box trucks', value: '25+' },
				{ label: 'tier 1 talent signed', value: '16' }
			]}
			col1={{
				title: 'ooh activation',
				images: [
					{
						src: '/wp-content/uploads/2025/02/041522_C4_COACHELLA_FINAL-27.jpg',
						alt: 'C4 Coachella activation',
						pullZone: 'wordpress',
						width: 1200,
						quality: 85
					},
					{
						src: '/wp-content/uploads/2025/02/060522_C4_WEHO-PRIDE-16-1-e1740530922745.jpeg',
						alt: 'C4 WeHo Pride activation',
						pullZone: 'wordpress',
						width: 1200,
						quality: 85
					}
				]
			}}
			col2={{
				images: [
					{
						src: '/wp-content/uploads/2025/02/C4_WRESTLEMANIA_FINAL-37.jpg',
						alt: 'C4 WrestleMania activation',
						pullZone: 'wordpress',
						width: 1200,
						quality: 85
					},
					{
						src: '/wp-content/uploads/2025/02/vegas-billboard-e1740533087657.jpg',
						alt: 'C4 Vegas billboard',
						pullZone: 'wordpress',
						width: 1200,
						quality: 85
					}
				]
			}}
			col3={{
				video: {
					src: 'https://times-10-video-offload.b-cdn.net/C4%20x%20WWE%20-%20AXXCESS%20Recap%20(1).mp4',
					pullZone: 'storage',
					priority: true
				}
			}}
		/>
		<script>
			// Centralized Case Study Button Initialization
			// This script initializes all case study sections once, preventing conflicts when multiple case studies exist
			(function() {
				// Use media query to check if mobile (more reliable than window.innerWidth)
				const isMobile = window.matchMedia('(max-width: 1023px)').matches;
				if (!isMobile) return;

				// Track initialized sections to prevent duplicate initialization
				const initializedSections = new WeakSet();

				function initCaseStudyButtons() {
					// Find all case study sections with mobile layout
					const sections = document.querySelectorAll('section');
					
					sections.forEach((section) => {
						const mobileLayout = section.querySelector('.mobile-layout');
						if (!mobileLayout) return; // Skip if not a case study component

						// Skip if already initialized
						if (initializedSections.has(section)) return;
						initializedSections.add(section);

						const tabButtons = section.querySelectorAll('.tab-button');
						const tabContents = section.querySelectorAll('.tab-content');
						const contentContainer = section.querySelector('.tab-content-container');
						const contentCard = section.querySelector('.content-card');
						const tabNav = section.querySelector('.content-card > div:first-child');

						if (!contentCard || !contentContainer) return;

						// Function to expand the card
						const expandCard = () => {
							if (mobileLayout) {
								mobileLayout.classList.add('expanded');
							}
							if (contentCard) {
								contentCard.classList.add('expanded');
							}
							if (contentContainer) {
								contentContainer.classList.add('has-content');
							}
						};

						// Function to collapse the card
						const collapseCard = () => {
							if (mobileLayout) {
								mobileLayout.classList.remove('expanded');
							}
							if (contentCard) {
								contentCard.classList.remove('expanded');
							}
							if (contentContainer) {
								contentContainer.classList.remove('has-content');
							}
						};

						// Check if card is expanded
						const isExpanded = () => {
							return contentCard.classList.contains('expanded');
						};

						// Handle button clicks/touches (if tabs exist)
						if (tabButtons.length > 0) {
							tabButtons.forEach((button) => {
								// Handle both click and touchstart for better mobile support
								const handleInteraction = (e: Event) => {
									e.preventDefault();
									e.stopPropagation();
									const targetTab = button.getAttribute('data-tab');
									if (!targetTab) return;

									// Expand card if not already expanded
									if (!isExpanded()) {
										expandCard();
									}

									// Only update button states and content visibility if there are multiple tabs
									if (tabContents.length > 0) {
										// Update button states
										tabButtons.forEach((btn) => btn.classList.remove('active'));
										button.classList.add('active');

										// Update content visibility
										tabContents.forEach((content) => {
											content.classList.remove('active');
											if (content instanceof HTMLElement && content.id === `${targetTab}-content`) {
												content.classList.add('active');
											}
										});
									}
								};

								button.addEventListener('click', handleInteraction, { passive: false });
								button.addEventListener('touchstart', handleInteraction, { passive: false });
							});
						}

						// Handle clicks on the tab navigation area to expand/collapse
						if (tabNav) {
							const handleNavClick = (e: Event) => {
								// Don't toggle if clicking on a tab button (handled above)
								if (e.target instanceof HTMLElement && e.target.classList.contains('tab-button')) {
									return;
								}
								
								// Expand on first click
								if (!isExpanded()) {
									expandCard();
								}
							};

							tabNav.addEventListener('click', handleNavClick);
							tabNav.addEventListener('touchstart', handleNavClick);
						}

						// Check if there's a whatWeDid prop by checking if overview tab exists
						const hasWhatWeDid = section.querySelector('#overview-content') !== null;
						
						// If no tabs and no whatWeDid, make the card header area clickable to expand
						if (!tabButtons.length && !hasWhatWeDid) {
							const cardHeader = section.querySelector('.content-card > div:first-child');
							if (cardHeader instanceof HTMLElement) {
								cardHeader.style.cursor = 'pointer';
								const handleHeaderClick = () => {
									if (!isExpanded()) {
										expandCard();
									}
								};
								cardHeader.addEventListener('click', handleHeaderClick);
								cardHeader.addEventListener('touchstart', handleHeaderClick);
							}
						}

						// Add click handler to collapse when clicking outside content (on card background)
						const handleCardClick = (e: Event) => {
							// If clicking on the card itself (not children) and expanded, collapse
							if (e.target === contentCard && isExpanded()) {
								collapseCard();
							}
						};
						contentCard.addEventListener('click', handleCardClick);
						contentCard.addEventListener('touchstart', handleCardClick);
					});
				}

				// Run immediately if DOM is ready, otherwise wait for DOMContentLoaded
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initCaseStudyButtons);
				} else {
					initCaseStudyButtons();
				}
			})();
		</script>
		<NavigationLinks
			id="navigation-links"
			links={[
				{ href: '/case-study/derrick-rose#drose-case-study-title', label: 'd. rose case study' }
			]}
		/>
		<HashScrollInit />
	</body>
</html>
