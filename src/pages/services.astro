---
import '../styles/global.css';
import { bunnyImage } from '../lib/bunny-cdn';
import ServicesSection from '../components/sections/Services/ServicesSection.astro';
import TitleSlide from '../components/sections/Services/TitleSlide.astro';
import ShortFormSocial from '../components/sections/ShortFormSocial/ShortFormSocial.astro';
import StackedVideos from '../components/sections/StackedVideos/StackedVideos.astro';
import ThreeImageGrid from '../components/sections/ThreeImageGrid/ThreeImageGrid.astro';
import ThreeImageGridFlipped from '../components/sections/ThreeImageGrid/ThreeImageGridFlipped.astro';
import TwoBlockGrid from '../components/sections/TwoBlockGrid/TwoBlockGrid.astro';
import AdidasWorldCup from '../components/sections/TwoBlockGrid/AdidasWorldCup.astro';
import TradeshowBooth from '../components/sections/TwoBlockGrid/TradeshowBooth.astro';
import InfluencerMarketing from '../components/sections/InfluencerMarketing/InfluencerMarketing.astro';
import InfluencerMarketing2 from '../components/sections/InfluencerMarketing/InfluencerMarketing2.astro';
import Website from '../components/sections/Website/Website.astro';
import Navigation from '../components/Navigation.astro';

// RULE-021: WordPress URL auto-conversion to Bunny CDN
const socialContentBg = bunnyImage('/wp-content/uploads/2025/04/03202025-Adidas-HardenV9Event-1041.jpg', {
	pullZone: 'wordpress',
	width: 1920,
	quality: 85
});

const photoSlideBg = bunnyImage('/wp-content/uploads/2025/03/C4-Lindsay-St-Louis-Niko-Selects1-53.jpg', {
	pullZone: 'wordpress',
	width: 1920,
	quality: 85
});

const designSlideBg = bunnyImage('/wp-content/uploads/2025/09/10.1.21-C4-STARBURST-TRUCK-24.jpg', {
	pullZone: 'wordpress',
	width: 1920,
	quality: 85
});

const websiteSlideBg = bunnyImage('/wp-content/uploads/2025/02/MyArcade-Mike-3.jpg', {
	pullZone: 'wordpress',
	width: 1920,
	quality: 85
});

// RULE-021: WordPress URL auto-conversion to Bunny CDN
const activationsSlideBg = bunnyImage('/wp-content/uploads/2025/04/RosesFlowerShop-WhiteSoxOpeningDay-Selects-040125-128-scaled.jpg', {
	pullZone: 'wordpress',
	width: 1920,
	quality: 85
});

// RULE-021: WordPress URL auto-conversion to Bunny CDN
const influencerMarketingSlideBg = bunnyImage('/wp-content/uploads/2025/08/PuraVida-061824-62-scaled.jpg', {
	pullZone: 'wordpress',
	width: 1200,
	quality: 85
});

// RULE-021: WordPress URL auto-conversion to Bunny CDN
const influencerMarketingSlideBgMobile = bunnyImage('/wp-content/uploads/2025/03/Clew-Danrue-ChanelWestCoast-Capes-scaled.jpg', {
	pullZone: 'wordpress',
	width: 1200,
	quality: 85
});
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>times10 - Services</title>
	</head>
	<body class="font-sans overflow-x-hidden bg-[#fdfffd]">
		<script>
			// Global error handler to prevent jQuery errors from breaking the page
			// jQuery may be injected by browser extensions or dev tools
			(function() {
				// Catch unhandled errors (including jQuery selector errors)
				window.addEventListener('error', function(event) {
					// Check if it's the jQuery selector error
					if (event.message && (
						event.message.includes("is not a valid selector") ||
						event.message.includes("*,:x") ||
						event.filename && event.filename.includes('jquery')
					)) {
						// Prevent the error from breaking the page
						event.preventDefault();
						console.warn('[Error Handler] Caught jQuery selector error (likely from browser extension):', event.message);
						return false;
					}
				}, true); // Use capture phase to catch errors early

				// Also catch unhandled promise rejections
				window.addEventListener('unhandledrejection', function(event) {
					if (event.reason && (
						event.reason.message && event.reason.message.includes("is not a valid selector") ||
						event.reason.message && event.reason.message.includes("*,:x")
					)) {
						event.preventDefault();
						console.warn('[Error Handler] Caught jQuery promise rejection:', event.reason);
					}
				});
			})();
		</script>
		<Navigation />
		<script>
			// Development: Save and restore scroll position
			// Remove this in production by deleting the script or setting ENABLE_SCROLL_RESTORE=false
			(function() {
				const STORAGE_KEY = 'dev-scroll-section';
				
				function initScrollRestore() {
					const sections = document.querySelectorAll('section[class*="snap-start"]');
					if (sections.length === 0) return;
					
					// Restore scroll position on load
					const savedIndex = sessionStorage.getItem(STORAGE_KEY);
					if (savedIndex !== null) {
						const index = parseInt(savedIndex, 10);
						if (index >= 0 && index < sections.length) {
							// Small delay to ensure layout is complete
							setTimeout(() => {
								sections[index].scrollIntoView({ behavior: 'instant' });
							}, 100);
						}
					}
					
					// Track current section using IntersectionObserver
					const observer = new IntersectionObserver((entries) => {
						entries.forEach((entry) => {
							if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
								const index = Array.from(sections).indexOf(entry.target);
								if (index !== -1) {
									sessionStorage.setItem(STORAGE_KEY, index.toString());
								}
							}
						});
					}, {
						threshold: 0.5,
						rootMargin: '-20% 0px -20% 0px'
					});
					
					// Observe all sections
					sections.forEach((section) => observer.observe(section));
				}
				
				// Wait for DOM to be ready
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initScrollRestore);
				} else {
					initScrollRestore();
				}
			})();
		</script>
		<ServicesSection id="services" />
		
		<!-- Social Content Section -->
		<TitleSlide 
			id="social-content-title"
			backgroundImage={socialContentBg}
			textParts={[
				{ text: 'social ', color: '#fff' },
				{ text: 'content', color: '#ca2c1e' }
			]}
			overlayOpacity={75}
		/>
		<ShortFormSocial 
			id="short-form-social"
			title="short form social"
			videos={[
				{ src: '/Adidas-ManchesterUnitedMeetAndGreet-Recap-Final-07.29.2025.mp4', pullZone: 'storage' },
				{ src: '/WWE-Capabilities-Recut-08.14.25.mp4', pullZone: 'storage' },
				{ src: '/wp-content/uploads/2025/03/PuraVida-WhatsYourSecret-Capes.mp4', pullZone: 'wordpress' },
				{ src: '/HowtoFlerish-FirstDate-Final.mp4', pullZone: 'storage' },
				{ src: '/wp-content/uploads/2025/02/Attomax-GolfBall-Hero-V4-1.mp4', pullZone: 'wordpress' },
				{ src: '/wp-content/uploads/2025/02/LaundrySauce_forhimandher-1.mp4', pullZone: 'wordpress' },
				{ src: '/RosesFlowerShop-WhiteSoxOpeningDay-CutdownIGV4-033125.mp4', pullZone: 'storage' },
				{ src: '/wp-content/uploads/2025/02/candace_parker_story_1-1080p.mp4', pullZone: 'wordpress' },
			]}
		/>
		<StackedVideos 
			id="stacked-videos-1"
			videos={[
				{ src: '/wp-content/uploads/2025/02/040722_C4_KevinHart_IgniteYourFire_PictureLock_FullLength_16x9_1920x1080.mp4', pullZone: 'wordpress' },
				{ src: '/wp-content/uploads/2025/03/3D-Hero-Video-1920x1080-1.mp4', pullZone: 'wordpress' },
				{ src: '/1920x1080_SocialPost-02-V1.mp4', pullZone: 'storage' },
				{ src: '/AlphaBounce-Capabilities-Recut-08.14.25.mp4', pullZone: 'storage' },
			]}
		/>
		<StackedVideos 
			id="stacked-videos-2"
			videos={[
				{ src: '/Adidas-HardenRecap-V2-032125.mp4', pullZone: 'storage' },
				{ src: '/Adidas HArden v2 Unboxing (updated) v2.mp4', pullZone: 'storage' },
				{ src: '/HypePromo-Capabilities-Recut-08.14.25.mp4', pullZone: 'storage' },
				{ src: '/wp-content/uploads/2025/02/CLEW-CarHero-Horz.mp4', pullZone: 'wordpress' },
			]}
		/>
		
		<!-- Photo Section -->
		<TitleSlide 
			id="photo-title"
			backgroundImage={photoSlideBg}
			textParts={[
				{ text: 'photo', color: '#fff' }
			]}
			overlayOpacity={75}
		/>
		<ThreeImageGrid
			id="photo-grid-1" 
			images={[
				{
					src: '/wp-content/uploads/2025/03/C4-SS-Montez-and-Bianca-89.jpg',
					alt: 'Partnerships',
					label: 'partnerships',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/08/Flerish-ProductPhotos-07.28.25-80.jpg',
					alt: 'Product',
					label: 'product',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/09/7.2.21-C4-x-SI-x-JASMINE-10-1-1.jpg',
					alt: 'Lifestyle',
					label: 'lifestyle',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			]}
		/>
		<ThreeImageGridFlipped 
			id="photo-grid-2"
			images={[
				{
					src: '/wp-content/uploads/2025/08/ClewDrais-53-1.jpg',
					alt: 'Event',
					label: 'event',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/02/060523-GoldGrove-62.jpeg',
					alt: 'Beauty',
					label: 'beauty',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/03/c4_07.09.22_austin_baura_9675.jpg',
					alt: 'Action + Sports',
					label: 'action + sports',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			]}
		/>
		
		<!-- Design Section -->
		<TitleSlide 
			id="design-title"
			backgroundImage={designSlideBg}
			textParts={[
				{ text: 'design', color: '#fff' }
			]}
			overlayOpacity={75}
		/>
		<ThreeImageGrid 
			id="design-grid-1"
			images={[
				{
					src: '/wp-content/uploads/2025/08/ManU-Social_newsroom-ask_post_v2.png',
					alt: 'Manchester United Social',
					label: 'digital ads',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85,
					type: 'image'
				},
				{
					src: '/wp-content/uploads/2025/04/Clew-Champs-LEDTruck-3.jpg',
					alt: 'Clew Champs LED Truck',
					label: 'ooh',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85,
					type: 'image'
				},
				{
					src: '/wp-content/uploads/2025/03/Instacart-1-16x9-1.mp4',
					alt: 'Instacart Video',
					label: 'digital banner',
					pullZone: 'wordpress',
					type: 'video'
				}
			]}
		/>
		<ThreeImageGridFlipped 
			id="design-grid-2"
			images={[
				{
					src: '/wp-content/uploads/2025/02/website-banner_black-background-1.mp4',
					alt: 'Website Banner',
					label: 'booth',
					pullZone: 'wordpress',
					type: 'video'
				},
				{
					src: '/wp-content/uploads/2025/03/Both-Render-5.5_0004.jpg',
					alt: '3D Render',
					label: '3d render',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85,
					type: 'image'
				},
				{
					src: '/wp-content/uploads/2025/03/Ryu-Pointing-Animation-2.mp4',
					alt: 'Ryu Animation',
					label: 'animation',
					pullZone: 'wordpress',
					type: 'video'
				}
			]}
		/>
		
		<!-- Activations & Sampling Section -->
		<TitleSlide 
			id="activations-title"
			backgroundImage={activationsSlideBg}
			textParts={[
				{ text: 'activations & ', color: '#fff' },
				{ text: 'sampling', color: '#ca2c1e' }
			]}
			overlayOpacity={75}
		/>
		<TwoBlockGrid
			id="activations-grid" 
			block1={{
				col1: [
					{ text: 'c4 wwe nashville summer slam' },
					{ 
						image: {
							src: '/wp-content/uploads/2025/02/C4-NASHVILLE-SUMMER-SLAM-DAY-1.jpg',
							alt: 'C4 Nashville Summer Slam Day 1',
							pullZone: 'wordpress',
							width: 1200,
							quality: 85
						}
					},
					{ 
						image: {
							src: '/wp-content/uploads/2025/02/C4-NASHVILLE-SUMMR-SLAM-DAY-47.jpg',
							alt: 'C4 Nashville Summer Slam Day 47',
							pullZone: 'wordpress',
							width: 1200,
							quality: 85
						}
					}
				],
				col2: [
					{ 
						video: {
							src: '/C4 Nashville Recap v3-2.mp4',
							pullZone: 'storage',
							priority: true
						}
					},
					{ 
						image: {
							src: '/wp-content/uploads/2025/02/C4-NASHVILLE-SUMMER-SLAM-DAY-55-e1740534310474.jpeg',
							alt: 'C4 Nashville Summer Slam Day 55',
							pullZone: 'wordpress',
							width: 1200,
							quality: 85
						}
					}
				]
			}}
			block2={{
				col1: [
					{ text: 'c4 sxsw' },
					{ 
						image: {
							src: '/wp-content/uploads/2025/02/031222_C4_SXSW_DAY-2_QUICKTURN-44.jpg',
							alt: 'C4 SXSW Day 2',
							pullZone: 'wordpress',
							width: 1200,
							quality: 85
						}
					},
					{ 
						image: {
							src: '/wp-content/uploads/2025/02/031122_C4_SXSW_DAY-1_QUICKTURN-24.jpg',
							alt: 'C4 SXSW Day 1',
							pullZone: 'wordpress',
							width: 1200,
							quality: 85
						}
					}
				],
				col2: [
					{ 
						video: {
							src: '/C4 - SXSW Recap (2nd Week).mp4',
							pullZone: 'storage',
							priority: false
						}
					}
				]
			}}
		/>
		<AdidasWorldCup 
			id="adidas-world-cup"
			title="adidas club world cup"
			block1={[
				{
					src: '/wp-content/uploads/2025/08/cwc1.jpg',
					alt: 'Adidas Club World Cup',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/08/cwc2.jpg',
					alt: 'Adidas Club World Cup',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/08/cwc3.jpg',
					alt: 'Adidas Club World Cup',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			]}
			block2={[
				{
					src: '/wp-content/uploads/2025/08/cwc4.jpg',
					alt: 'Adidas Club World Cup',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/08/cwc5.jpg',
					alt: 'Adidas Club World Cup',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			]}
		/>
		<TradeshowBooth 
			id="tradeshow-booth"
			title="tradeshow booth"
			col1={[
				{
					src: '/wp-content/uploads/2025/08/pv-177.jpg',
					alt: 'Tradeshow Booth',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/08/pv-179-clean-1-1.jpg',
					alt: 'Tradeshow Booth',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			]}
			col2={{
				src: '/wp-content/uploads/2025/08/Attomax-clean-1-1.jpg',
				alt: 'Tradeshow Booth',
				pullZone: 'wordpress',
				width: 1200,
				quality: 85
			}}
			col3={[
				{
					src: '/wp-content/uploads/2025/04/Clew-Pouches_Champs_All-JPEG-54-1_1.jpg',
					alt: 'Tradeshow Booth',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/04/Clew-Pouches_Champs_All-JPEG-50_1.jpg',
					alt: 'Tradeshow Booth',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			]}
		/>
		<TitleSlide 
			id="influencer-marketing-title"
			backgroundImage={influencerMarketingSlideBg}
			backgroundImageMobile={influencerMarketingSlideBgMobile}
			textParts={[
				{ text: 'influencer ', color: '#fff' },
				{ text: 'marketing', color: '#ca2c1e' }
			]}
			overlayOpacity={75}
		/>
		<InfluencerMarketing id="influencer-marketing" />
		<InfluencerMarketing2 id="influencer-marketing-2" />
		
		<!-- Website Section -->
		<TitleSlide 
			id="website-title"
			backgroundImage={websiteSlideBg}
			textParts={[
				{ text: 'website', color: '#fff' }
			]}
			overlayOpacity={75}
		/>
		<Website
			id="website" 
			images={[
				{
					src: '/wp-content/uploads/2025/02/MyArcade_Times10_Carousel_9.jpg',
					alt: 'MyArcade website',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				},
				{
					src: '/wp-content/uploads/2025/02/MyArcade_Times10_Carousel_6.jpg',
					alt: 'MyArcade website',
					pullZone: 'wordpress',
					width: 1200,
					quality: 85
				}
			]}
			video={{
				src: 'https://times-10-video-offload.b-cdn.net/MyArcade_Times10_Carousel_2.mp4',
				pullZone: 'wordpress',
				priority: true
			}}
		/>
		<script>
			// Hash Scroll Manager - Handles both same-page and cross-page hash navigation
			// @ts-ignore - Inline script types
			(function() {
				function initHashScroll() {
					// Track if we're updating hash programmatically (to prevent scroll loops)
					let isUpdatingHash = false;
					
					// Helper function to generate section IDs
					function generateSectionId(section: Element, index: number): string {
						const heading = section.querySelector('h1, h2, h3, h4, h5, h6');
						if (heading) {
							const text = heading.textContent?.trim().toLowerCase() || '';
							if (text) {
								const slug = text
									.replace(/[^\w\s-]/g, '')
									.replace(/\s+/g, '-')
									.replace(/-+/g, '-')
									.replace(/^-|-$/g, '');
								if (slug.length > 0) {
									return slug;
								}
							}
						}
						return `section-${index + 1}`;
					}
					
					// Helper function to ensure all sections have IDs
					function ensureSectionIds(): void {
						const sections = document.querySelectorAll<HTMLElement>('section[class*="snap-start"]');
						sections.forEach((section, index) => {
							if (!section.id) {
								const sectionId = generateSectionId(section, index);
								section.id = sectionId;
							}
						});
					}
					
					// Helper function to scroll to hash target
					function scrollToHash(hash: string): boolean {
						// Ensure IDs are generated before looking for the target
						ensureSectionIds();
						
						const targetSection = document.getElementById(hash);
						if (targetSection) {
							// Use requestAnimationFrame to ensure layout is complete
							requestAnimationFrame(() => {
								requestAnimationFrame(() => {
									isUpdatingHash = true;
									targetSection.scrollIntoView({ behavior: 'instant' });
									// Reset flag after scroll completes
									setTimeout(() => {
										isUpdatingHash = false;
									}, 100);
								});
							});
							return true;
						}
						return false;
					}
					
					// Find all sections with snap-start class
					const sections = document.querySelectorAll<HTMLElement>('section[class*="snap-start"]');
					
					if (sections.length === 0) return;
					
					// Generate section IDs if they don't exist
					ensureSectionIds();
					
					// Handle initial hash on page load
					// This handles both same-page navigation and cross-page navigation
					const initialHash = window.location.hash.slice(1); // Remove #
					if (initialHash) {
						// Try immediately if page is already loaded
						if (document.readyState === 'complete') {
							// Page is fully loaded, try scrolling
							if (!scrollToHash(initialHash)) {
								// Element not found, retry with delay (might be dynamically added)
								setTimeout(() => {
									scrollToHash(initialHash);
								}, 300);
							}
						} else {
							// Wait for page to be fully loaded (including images, etc.)
							window.addEventListener('load', () => {
								if (!scrollToHash(initialHash)) {
									// Retry after a short delay if element still not found
									setTimeout(() => {
										scrollToHash(initialHash);
									}, 300);
								}
							}, { once: true });
						}
					}
					
					// Use Intersection Observer to detect visible sections
					const observer = new IntersectionObserver(
						(entries) => {
							// Don't update hash if we're programmatically scrolling
							if (isUpdatingHash) return;
							
							// Find the section with highest intersection ratio
							let maxRatio = 0;
							let activeSection: HTMLElement | null = null;
							
							for (const entry of entries) {
								if (entry.isIntersecting && entry.intersectionRatio > maxRatio) {
									maxRatio = entry.intersectionRatio;
									if (entry.target instanceof HTMLElement) {
										activeSection = entry.target;
									}
								}
							}
							
							// Update hash if we found an active section
							if (activeSection && activeSection.id) {
								const newHash = `#${activeSection.id}`;
								if (window.location.hash !== newHash) {
									// Use replaceState to avoid adding history entries
									window.history.replaceState(null, '', newHash);
								}
							}
						},
						{
							// Trigger when section is mostly visible (50%+)
							threshold: [0.5, 0.75, 1.0],
							// Add some margin to trigger slightly before section is fully visible
							rootMargin: '-10% 0px -10% 0px'
						}
					);
					
					// Observe all sections
					sections.forEach((section) => observer.observe(section));
					
					// Handle browser back/forward buttons
					window.addEventListener('popstate', () => {
						const hash = window.location.hash.slice(1);
						if (hash) {
							const targetSection = document.getElementById(hash);
							if (targetSection) {
								isUpdatingHash = true;
								targetSection.scrollIntoView({ behavior: 'smooth' });
								setTimeout(() => {
									isUpdatingHash = false;
								}, 500);
							}
						}
					});
				}
				
				// Initialize hash scroll functionality
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', initHashScroll);
				} else {
					initHashScroll();
				}
			})();
		</script>
	</body>
</html>
